# üè≠ SIGETI Data Warehouse - Production Ready

[![Status](https://img.shields.io/badge/Status-Production%20Ready-brightgreen)](https://github.com)
[![Version](https://img.shields.io/badge/Version-1.0.0-blue)](https://github.com)
[![Database](https://img.shields.io/badge/Database-PostgreSQL-336791)](https://postgresql.org)
[![ETL](https://img.shields.io/badge/ETL-Python%20%2B%20dbt-ff6b35)](https://www.getdbt.com)
[![Orchestration](https://img.shields.io/badge/Orchestration-Apache%20Airflow-017cee)](https://airflow.apache.org)

## üìã Vue d'Ensemble

Le **SIGETI Data Warehouse** est une solution compl√®te d'analyse des demandes d'attribution industrielle, con√ßue pour traiter et analyser les donn√©es de financement des entreprises dans les zones industrielles.

### üéØ Objectifs
- **Analyse des KPI** : 7 indicateurs cl√©s de performance
- **Automatisation compl√®te** : Pipeline ETL automatis√© avec Airflow
- **Sch√©ma en √©toile** : Architecture optimis√©e pour l'analyse
- **Temps r√©el** : Mise √† jour quotidienne des donn√©es

### üìä Donn√©es M√©tier
- **üí∞ Financement total** : 3,100,500,000 ‚Ç¨
- **üë• Emplois cr√©√©s** : 1,350 postes
- **üè¢ Entreprises** : 17 entreprises uniques
- **üìç Zones industrielles** : 6 zones
- **üì¶ Lots trait√©s** : 49 lots
- **üìà KPI disponibles** : 7 indicateurs m√©tier sp√©cialis√©s

---

## üèóÔ∏è Architecture du Syst√®me

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  sigeti_node_db ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   ETL Python    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   sigeti_dwh    ‚îÇ
‚îÇ   (Source)      ‚îÇ    ‚îÇ  + Pandas       ‚îÇ    ‚îÇ (Data Warehouse)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                        ‚îÇ
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ   Apache        ‚îÇ    ‚îÇ   dbt Models    ‚îÇ
                       ‚îÇ   Airflow       ‚îÇ    ‚îÇ (Transformations)‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                        ‚îÇ
                                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                              ‚îÇ   7 Vues KPI    ‚îÇ
                                              ‚îÇ  (Analytics)    ‚îÇ
                                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîß Composants Techniques

| Composant | Technologie | R√¥le |
|-----------|-------------|------|
| **Source** | PostgreSQL | Base de donn√©es source SIGETI |
| **ETL** | Python + Pandas | Extraction et chargement des donn√©es |
| **Transformation** | dbt 1.10.13 | Mod√©lisation dimensionnelle |
| **Orchestration** | Apache Airflow | Automatisation des pipelines |
| **Stockage** | PostgreSQL | Data warehouse optimis√© |
| **Analytics** | SQL Views | Vues KPI pour reporting |

---

## üìÅ Structure du Projet

```
SIGETI_DWH/
‚îú‚îÄ‚îÄ üìú Scripts de Production
‚îÇ   ‚îú‚îÄ‚îÄ etl_sigeti.py              # ETL principal (Python + Pandas)
‚îÇ   ‚îú‚îÄ‚îÄ create_kpi_views.py        # D√©ploiement des vues KPI
‚îÇ   ‚îú‚îÄ‚îÄ cleanup_databases.py       # Maintenance et nettoyage
‚îÇ   ‚îî‚îÄ‚îÄ validate_final_system.py   # Validation syst√®me compl√®te
‚îÇ
‚îú‚îÄ‚îÄ üîÑ Orchestration Airflow
‚îÇ   ‚îî‚îÄ‚îÄ airflow/dags/
‚îÇ       ‚îú‚îÄ‚îÄ sigeti_etl_pipeline.py     # Pipeline ETL principal
‚îÇ       ‚îî‚îÄ‚îÄ sigeti_kpi_monitoring.py   # Monitoring KPI
‚îÇ
‚îú‚îÄ‚îÄ üèóÔ∏è Mod√®les dbt
‚îÇ   ‚îî‚îÄ‚îÄ dbt_sigeti/
‚îÇ       ‚îú‚îÄ‚îÄ models/staging/        # Tables de staging
‚îÇ       ‚îú‚îÄ‚îÄ models/marts/          # Sch√©ma en √©toile
‚îÇ       ‚îî‚îÄ‚îÄ dbt_project.yml        # Configuration dbt
‚îÇ
‚îú‚îÄ‚îÄ üìä Vues KPI M√©tier (7 indicateurs)
‚îÇ   ‚îî‚îÄ‚îÄ sql_views/
‚îÇ       ‚îú‚îÄ‚îÄ 01_v_kpi_demandes_par_statut.sql       # EN_COURS, VALID√âE, REJET√âE
‚îÇ       ‚îú‚îÄ‚îÄ 02_v_kpi_demandes_par_type.sql         # Zone industrielle vs hors zone  
‚îÇ       ‚îú‚îÄ‚îÄ 03_v_kpi_demandes_par_entite.sql       # Zone/lot/entreprise
‚îÇ       ‚îú‚îÄ‚îÄ 04_v_kpi_demandes_prioritaires.sql     # Prioritaires vs normales
‚îÇ       ‚îú‚îÄ‚îÄ 05_v_kpi_delai_traitement.sql          # D√©lais cr√©ation ‚Üí validation
‚îÇ       ‚îú‚îÄ‚îÄ 06_v_kpi_taux_acceptation.sql          # Taux d'approbation
‚îÇ       ‚îî‚îÄ‚îÄ 07_v_kpi_evolution_prioritaires.sql    # √âvolution temporelle
‚îÇ
‚îú‚îÄ‚îÄ üíæ Sauvegardes
‚îÇ   ‚îî‚îÄ‚îÄ backups/                   # Sauvegardes automatiques
‚îÇ
‚îú‚îÄ‚îÄ üìö Documentation
‚îÇ   ‚îú‚îÄ‚îÄ DOCUMENTATION_COMPLETE.md  # Documentation technique compl√®te
‚îÇ   ‚îú‚îÄ‚îÄ RAPPORT_NETTOYAGE_FINAL.md # Rapport d'optimisation
‚îÇ   ‚îú‚îÄ‚îÄ RESUME_EXECUTIF.md         # R√©sum√© pour les d√©cideurs
‚îÇ   ‚îî‚îÄ‚îÄ README_VALIDATION.md       # Proc√©dures de validation
‚îÇ
‚îî‚îÄ‚îÄ üóÑÔ∏è Archive
    ‚îî‚îÄ‚îÄ archive_dev/               # Scripts de d√©veloppement archiv√©s
```

---

## üöÄ Installation et D√©ploiement

### Pr√©requis
```bash
# Versions requises
Python >= 3.8
PostgreSQL >= 12
Apache Airflow >= 2.0
dbt-postgres >= 1.0
```

### 1. Installation des D√©pendances
```bash
pip install -r requirements.txt
```

### 2. Configuration des Bases de Donn√©es
```sql
-- Cr√©er les bases de donn√©es
CREATE DATABASE sigeti_node_db;  -- Source
CREATE DATABASE sigeti_dwh;      -- Data Warehouse
```

### 3. Ex√©cution du Pipeline
```bash
# 1. ETL initial
python etl_sigeti.py

# 2. Transformation dbt
cd dbt_sigeti
dbt run

# 3. D√©ploiement des vues KPI
python create_kpi_views.py

# 4. Validation syst√®me
python validate_final_system.py
```

---

## üìà 7 Vues KPI M√©tier Sp√©cialis√©es

| # | Vue KPI | Description M√©tier | Cas d'Usage |
|---|---------|-------------------|-------------|
| **1** | **v_kpi_demandes_par_statut** | Demandes par statut (EN_COURS, VALID√âE, REJET√âE) | Suivi op√©rationnel, tableau de bord |
| **2** | **v_kpi_demandes_par_type** | Demandes par type zone (INDUSTRIELLE vs HORS_ZONE) | Analyse g√©ographique, planification |
| **3** | **v_kpi_demandes_par_entite** | Demandes par zone/lot/entreprise | Analyse d√©taill√©e, performance entit√©s |
| **4** | **v_kpi_demandes_prioritaires** | Demandes prioritaires vs normales | Gestion des priorit√©s, allocation ressources |
| **5** | **v_kpi_delai_traitement** | D√©lai moyen cr√©ation ‚Üí validation/rejet | Performance processus, SLA |
| **6** | **v_kpi_taux_acceptation** | Taux d'acceptation/approbation | Indicateur qualit√©, efficacit√© |
| **7** | **v_kpi_evolution_prioritaires** | √âvolution prioritaires par p√©riode | Tendances, analyse temporelle |

### üéØ Exemples d'Utilisation des KPI

```sql
-- KPI 1: R√©partition des demandes par statut
SELECT statut, nombre_demandes, pourcentage, montant_total 
FROM public.v_kpi_demandes_par_statut 
ORDER BY nombre_demandes DESC;

-- KPI 3: Top 5 des entit√©s les plus actives  
SELECT zone_industrielle, entreprise, nombre_demandes, montant_total_finance
FROM public.v_kpi_demandes_par_entite 
ORDER BY nombre_demandes DESC 
LIMIT 5;

-- KPI 6: Performance globale d'acceptation
SELECT taux_acceptation_pourcentage, demandes_validees, demandes_rejetees, total_demandes
FROM public.v_kpi_taux_acceptation;

-- KPI 7: √âvolution mensuelle des priorit√©s
SELECT mois_nom_fr, total_demandes, pourcentage_prioritaires, montant_total_periode
FROM public.v_kpi_evolution_prioritaires 
ORDER BY annee, mois;
```

### üìä Dashboard Ex√©cutif Recommand√©
```sql
-- Vue consolid√©e pour direction
SELECT 
    'Statuts' as categorie,
    statut as libelle,
    nombre_demandes as valeur,
    pourcentage as pct
FROM v_kpi_demandes_par_statut
UNION ALL
SELECT 
    'Priorit√©s',
    niveau_priorite,
    nombre_demandes,
    pourcentage
FROM v_kpi_demandes_prioritaires;
```

---

## üéØ Sp√©cifications KPI M√©tier

### KPI 1: Demandes par Statut
**Objectif** : Suivi op√©rationnel en temps r√©el des demandes  
**M√©triques** : Nombre, pourcentage, montants par statut (EN_COURS, VALID√âE, REJET√âE)  
**Usage** : Tableau de bord quotidien, reporting direction

### KPI 2: Demandes par Type de Zone  
**Objectif** : Analyse g√©ographique et planification territoriale  
**M√©triques** : R√©partition ZONE_INDUSTRIELLE vs HORS_ZONE avec impacts financiers  
**Usage** : Strat√©gie d'implantation, allocation budg√©taire

### KPI 3: Performance par Entit√©
**Objectif** : Analyse d√©taill√©e zone/lot/entreprise  
**M√©triques** : Volume, montants, emplois, d√©lais par combinaison d'entit√©s  
**Usage** : √âvaluation performance, identification opportunit√©s

### KPI 4: Priorit√©s vs Normales
**Objectif** : Gestion des priorit√©s et allocation des ressources  
**M√©triques** : Comparaison demandes prioritaires/normales avec impacts  
**Usage** : Optimisation processus, gestion de la charge

### KPI 5: D√©lais de Traitement
**Objectif** : Performance processus et respect des SLA  
**M√©triques** : D√©lais moyen/m√©dian, r√©partition temporelle (‚â§7j, 8-15j, >15j)  
**Usage** : Am√©lioration continue, respect engagements

### KPI 6: Taux d'Acceptation
**Objectif** : Indicateur qualit√© et efficacit√© du processus  
**M√©triques** : Ratios acceptation/rejet, volumes par statut final  
**Usage** : Pilotage qualit√©, am√©lioration processus d√©cision

### KPI 7: √âvolution Temporelle
**Objectif** : Analyse des tendances et saisonnalit√©  
**M√©triques** : √âvolution mensuelle/trimestrielle des priorit√©s et volumes  
**Usage** : Planification, pr√©visions, analyse de tendances

---

## üîÑ Automatisation Airflow

### Pipeline Principal (`sigeti_etl_pipeline`)
- **Fr√©quence** : Quotidienne (8h00)
- **Dur√©e** : ~5 minutes
- **√âtapes** :
  1. Extraction donn√©es source
  2. Transformation dbt
  3. D√©ploiement vues KPI
  4. Tests de validation

### Monitoring KPI (`sigeti_kpi_monitoring`)
- **Fr√©quence** : Toutes les 4 heures
- **Alertes** : Email en cas d'anomalie
- **M√©triques** : Performance syst√®me, qualit√© donn√©es

---

## üõ†Ô∏è Maintenance et Monitoring

### Scripts de Maintenance
```bash
# Nettoyage mensuel
python cleanup_databases.py

# Validation compl√®te
python validate_final_system.py

# Sauvegarde manuelle
pg_dump sigeti_dwh > backup_$(date +%Y%m%d).sql
```

### Indicateurs de Sant√©
- **Taille base** : < 50 MB (actuellement 10 MB)
- **Temps r√©ponse KPI** : < 0.1 seconde (7 vues optimis√©es)
- **Taux de succ√®s ETL** : > 95%
- **Disponibilit√©** : 99.9%
- **Couverture KPI** : 7/7 indicateurs m√©tier op√©rationnels
- **Donn√©es trait√©es** : 5 demandes, 3.1Md‚Ç¨, 1350 emplois

---

## üìû Support et Contact

### √âquipe Projet
- **D√©veloppeur Principal** : Data Engineering Team
- **Architecture** : PostgreSQL + Python + dbt + Airflow
- **Environnement** : Windows + VS Code + GitHub Copilot

### Ressources
- üìñ **Documentation technique** : `DOCUMENTATION_COMPLETE.md`
- üìä **Rapport final** : `RAPPORT_NETTOYAGE_FINAL.md`
- üéØ **R√©sum√© ex√©cutif** : `RESUME_EXECUTIF.md`
- ‚úÖ **Proc√©dures validation** : `README_VALIDATION.md`

---

## üîß Utilisation Avanc√©e et Maintenance

### Connexion √† la Base KPI
```python
# Configuration connexion PostgreSQL
HOST = 'localhost'
PORT = '5432'
DATABASE = 'sigeti_dwh' 
USER = 'sigeti_user'

# Exemple requ√™te crois√©e KPI
SELECT s.nb_demandes_statut, t.nb_zone_industrielle 
FROM v_kpi_demandes_par_statut s, v_kpi_demandes_par_type t;
```

### Int√©gration Dashboard
- **Grafana** : Configuration automatique via docker-compose (port 3000)
- **Power BI** : Connexion directe PostgreSQL sur port 5432
- **Tableau** : Import des 7 vues KPI via connecteur PostgreSQL
- **Excel** : Export CSV via requ√™tes ou connexion ODBC

### Maintenance et Monitoring
```bash
# V√©rification logs ETL
docker-compose logs airflow-webserver

# Test manuel des KPI
python scripts/create_kpi_views.py

# Validation donn√©es
psql -h localhost -U sigeti_user -d sigeti_dwh -c "SELECT count(*) FROM v_kpi_demandes_par_statut;"
```

### √âvolutivit√© du Syst√®me
- **Nouveaux KPI** : Ajout dans `create_kpi_views.py`
- **Nouveaux connecteurs** : Extension `dag_sigeti_etl.py`
- **Historisation** : Configuration r√©tention dans `airflow.cfg`
- **Sauvegarde** : Script automatis√© `backup_dwh.py` (hebdomadaire)

### Support et D√©pannage
- **Logs applicatifs** : `/airflow/logs/`
- **Monitoring base** : via Grafana dashboard ou requ√™tes directes
- **Alertes** : Configuration Airflow pour √©checs pipeline
- **Performance** : Index automatiques sur cl√©s de jointure KPI

---

## üê≥ D√©ploiement Docker

Le projet est **enti√®rement dockeris√©** (sauf les bases de donn√©es qui restent locales) pour faciliter le d√©ploiement et la maintenance.

### üöÄ **D√©marrage Rapide**
```powershell
# Construction des images
.\docker-sigeti.ps1 build

# D√©marrage de tous les services
.\docker-sigeti.ps1 up

# V√©rification du statut
.\docker-sigeti.ps1 status
```

### üåê **Services Disponibles**
- **Airflow** : http://localhost:8080 (admin/admin123)
- **Grafana** : http://localhost:3000 (admin/admin123)
- **Jupyter** : http://localhost:8888 (token: sigeti123)
- **Flower** : http://localhost:5555 (monitoring Celery)
- **Prometheus** : http://localhost:9090 (m√©triques)

### üîß **Commandes Utiles**
```powershell
# Voir les logs en temps r√©el
.\docker-sigeti.ps1 logs

# Test de connexion aux DBs locales
.\docker-sigeti.ps1 test-db-connection

# Ex√©cution manuelle des KPI
.\docker-sigeti.ps1 test-kpi

# Mode d√©veloppement avec hot-reload
.\docker-sigeti.ps1 dev
```

### üìñ **Documentation D√©taill√©e**
Consultez `DOCKER_README.md` pour :
- Configuration compl√®te des services
- Troubleshooting et diagnostic
- Mode d√©veloppement
- Configuration monitoring
- Sauvegarde et restauration

---

## üèÜ Statut du Projet

‚úÖ **D√©veloppement** : Termin√© (100%)  
‚úÖ **Tests** : Valid√©s (100% des tests r√©ussis)  
‚úÖ **Optimisation** : Compl√®te (nettoyage effectu√©)  
‚úÖ **Documentation** : √Ä jour (compl√®te)  
‚úÖ **Production** : D√©ploy√© et op√©rationnel  

### Derni√®re Mise √† Jour
- **Date** : 27 octobre 2025
- **Version** : 2.0.0 Production (KPI M√©tier Sp√©cialis√©s)
- **Statut** : ‚úÖ Syst√®me valid√© et optimis√©
- **Nouveaut√©s** : 7 KPI m√©tier adapt√©s aux besoins sp√©cifiques
- **Performance** : Toutes les vues valid√©es et fonctionnelles

---

*Syst√®me SIGETI Data Warehouse - Pr√™t pour la Production üöÄ*